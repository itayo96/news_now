@model Tuple<IEnumerable<Article>, IEnumerable<Comment>>
@{
    ViewBag.Title = "Search";
}

<h2>@ViewBag.Title</h2>

<ul class="nav nav-tabs" role="tablist">
    <li class="nav-item">
        <a class="nav-link" href="#articles" role="tab" data-toggle="tab" onclick="update_searched_results('articles')">articles</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#comments" role="tab" data-toggle="tab" onclick="update_searched_results('comments')">comments</a>
    </li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
    <div role="tabpanel" class="tab-pane fade" id="articles">
        <br />
        <div class="row">
            <div class="col-sm">
                <select id="cat-input" name="CategoryId" class="form-control">
                    <option style="display:none">Category</option>
                    @foreach (var item in ViewBag.Categories)
                    {
                        <option value="@item.Value">@item.Text</option>
                    }
                </select>
            </div>
            <div class="col-sm">
                <input id="title-input" type="text" class="form-control" placeholder="Title" />
            </div>
            <div class="col-sm">
                <input id="summery-input" type="text" class="form-control" placeholder="Summery" />
            </div>
            <div class="col-sm">
                <input id="date-input" type="date" class="form-control" />
            </div>
            <input type="button" value="Search" class="btn btn-primary" onclick="update_searched_results('articles');" />
        </div>
    </div>
    <div role="tabpanel" class="tab-pane fade" id="comments">
        <br />
        <div class="row">
            <div class="col-sm">
                <input id="author-input" type="text" class="form-control" placeholder="Author" />
            </div>
            <div class="col-sm">
                <input id="content-input" type="text" class="form-control" placeholder="Content" />
            </div>
            <input type="button" value="Search" class="btn btn-primary" onclick="update_searched_results('comments');" />
        </div>
    </div>

    <br />
    <div id="searched-results"></div>
</div>

@section Scripts
    {
    <script id="searchedArticlesTmpl" type="text/x-jQuery-tmpl">
        <a href="#">${header}</a>
        <br />
    </script>

    <script id="searchedArticlesTmpl" type="text/x-jQuery-tmpl">
        $("#commentTemplate").tmpl(comment)
        <a href="/Articles/Details/" + ${ArticleId}>Go to article</a>
    </script>

    <script type="text/javascript">
        var update_searched_results = function (type) {
            $("#searched-results").html("");
            if (type == 'articles') {
                get_searched_articles(
                    $('#cat-input').val(),
                    $('#title-input').val(),
                    $('#summery-input').val(),
                    $('#date-input').val()
                ).then(function (articles) {
                    $("#searched-results").html("");
                    articles.forEach(article => {
                        $("#searchedArticlesTmpl").tmpl(article).appendTo("#searched-results");
                    })
                })
            }
            else if (type == 'comments') {
                get_searched_comments(
                    $('#author-input').val(),
                    $('#content-input').val()
                ).then(function (comments) {
                    $("#searched-results").html("");
                    comments.forEach(comment => {
                        $("#searchedCommentsTmpl").tmpl(comment).appendTo("#searched-results");
                    })
                })
            }
        }

    </script>
}