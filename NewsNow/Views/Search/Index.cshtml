@model Tuple<IEnumerable<Article>, IEnumerable<Comment>>
@{
    ViewBag.Title = "Search";
}

<h2>@ViewBag.Title</h2>

<ul class="nav nav-tabs" role="tablist">
    <li class="nav-item">
        <a id="#active-tab" class="nav-link" href="#articles" role="tab" data-toggle="tab">articles</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#comments" role="tab" data-toggle="tab">comments</a>
    </li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
    <div role="tabpanel" class="tab-pane fade" id="articles">
        <br />
        <div class="row">
            <div class="col-sm">
                <select id="cat-input" name="CategoryId" class="form-control">
                    <option style="display:none">Category</option>
                    @foreach (var item in ViewBag.Categories)
                    {
                        <option value="@item.Value">@item.Text</option>
                    }
                 </select>
            </div>
            <div class="col-sm">
                <input id="title-input" type="text" class="form-control" placeholder="Title" />
            </div>
            <div class="col-sm">
                <input id="summery-input" type="text" class="form-control" placeholder="Summery" />
            </div>
            <div class="col-sm">
                <input id="date-input" type="date" class="form-control" />
            </div>
            <input type="button" value="Search" class="btn btn-primary" onclick="update_searched_articles();" />
        </div>

        <br />
        <div id="searched-articles"></div>
    </div>
    <div role="tabpanel" class="tab-pane fade" id="comments">

        <br />
        @using (Html.BeginForm("Index", "Search", FormMethod.Get))
        {
            @Html.AntiForgeryToken()
            <div class="row">
                <div class="col-sm">
                    @Html.TextBox("Author", "", new { @class = "form-control", @placeholder = "Author" })
                </div>
                <div class="col-sm">
                    @Html.TextBox("Content", "", new { @class = "form-control", @placeholder = "Content" })
                </div>
                <div class="col-sm">
                    @Html.TextBox("ArticleId", "", new { @class = "form-control", @placeholder = "ArticleId" })
                </div>
                <input type="submit" value="Search" class="btn btn-primary" />
            </div>
        }

        <br />
        @if (Model != null && Model.Item2 != null && Model.Item2.Any())
        {
            foreach (var item in Model.Item2)
            {
                <a asp-controller="Articles" asp-action="Details" asp-route-id="@item.ArticleId">
                    <dd>
                        @Html.DisplayFor(model => item.Content)
                    </dd>
                </a>
            }
        }
    </div>
</div>

@section Scripts
    {
    <script id="searchedArticlesTmpl" type="text/x-jQuery-tmpl">
        <a href="#">${header}</a><br/>
    </script>

    <script type="text/javascript">

        $(document).ready(function () {
            update_searched_articles()
        })

        var update_searched_articles = function () {
            get_searched_articles(
                $('#cat-input').val(),
                $('#title-input').val(),
                $('#summery-input').val(),
                $('#date-input').val()
            ).then(function (articles) {
                $("#searched-articles").html("");
                articles.forEach(article => {
                    $("#searchedArticlesTmpl").tmpl(article).appendTo("#searched-articles");
                })
            })
        }

    </script>
}